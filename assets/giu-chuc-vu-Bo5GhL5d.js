import{_ as T,S as m,b as d,A as _,c,d as V,a as o,e as g,w as C,v as k,F as p,g as f,f as v,o as h,t as r,y as M,z as b}from"./index-DsFX8v4I.js";import{l as w,a as D,s as K}from"./so-sanh-nam-s7tHrirU.js";const x={props:{isOpen:Boolean},data(){return{hienKetQua:!1,MaGV:"",MaCV:"",HocKy:"",NamHoc:"",namHocDuocChon:"",hocKyDuocChon:"",danhSachChucVu:[],danhSachNamHoc:[],tuKhoaTimKiem:"",ketQuaTimKiem:[],duocThem:!1}},watch:{namHocDuocChon(n){this.updateDuocThem()},hocKyDuocChon(){this.updateDuocThem()},HocKy(){this.updateDuocThem()},NamHoc(){this.updateDuocThem()}},async created(){await this.lay_nam_hoc_va_hoc_ky(),await this.hien_danh_sach_chuc_vu(),await this.hien_danh_sach_nam_hoc()},methods:{updateDuocThem(){const n=K(this.NamHoc,this.namHocDuocChon);if(n=="nam_truoc")this.duocThem=!1;else if(n=="nam_sau")this.duocThem=!0;else if(n=="nam_hien_tai"){const t=parseInt(this.HocKy)||0,u=parseInt(this.hocKyDuocChon)||0;this.duocThem=u>=t}else this.duocThem=!1},async lay_nam_hoc_va_hoc_ky(){try{this.NamHoc=await w(),this.HocKy=await D()}catch(n){console.log("Lá»—i láº¥y nÄƒm há»c vÃ  há»c ká»³: ",n)}},async hien_danh_sach_chuc_vu(){try{const n=await d.get(`${_}/chuc-vu/danh-sach-chuc-vu`);n.data.success&&(this.danhSachChucVu=n.data.data)}catch(n){throw console.log(n),n}},async hien_danh_sach_nam_hoc(){try{const n=await d.get(`${_}/nam-hoc/danh-sach-nam-hoc`);n.data.success&&(this.danhSachNamHoc=n.data.data)}catch(n){throw console.log(n),n}},async goi_api_tim_giao_vien(){this.hienKetQua=!0,this.MaGV="";try{const n=await d.get(`
                    ${_}/giao-vien/tim-giao-vien?keyword=${this.tuKhoaTimKiem}
                `);n.data.success&&(this.ketQuaTimKiem=n.data.data)}catch(n){throw console.log("Lá»—i tÃ¬m gv: ",n),n}},them_vao_the_input(n){this.MaGV=n},reset(){this.hienKetQua=!1,this.tuKhoaTimKiem="",this.ketQuaTimKiem="",this.MaGV="",this.MaCV=""},them_giu_chuc_vu(){if(!this.duocThem){m.fire({title:"ThÃ´ng tin khÃ´ng há»£p lá»‡!",text:"Vui lÃ²ng chá»n nÄƒm há»c há»£p lá»‡, khÃ´ng thá»ƒ chá»n nÄƒm há»c - há»c ká»³ cÅ©",icon:"warning",confirmButtonText:"OK",confirmButtonColor:"#3085d6"}),console.log(this.NamHoc),console.log(this.namHocDuocChon);return}if(!this.MaGV||!this.MaCV){m.fire({title:"Thiáº¿u thÃ´ng tin!",text:"Vui lÃ²ng nháº­p Ä‘á»§ thÃ´ng tin trÆ°á»›c khi lÆ°u.",icon:"warning",confirmButtonText:"OK",confirmButtonColor:"#3085d6"});return}const n={MaGV:this.MaGV.toUpperCase(),MaCV:this.MaCV,HocKy:this.HocKy,NamHoc:this.NamHoc};this.$emit("save",n),this.reset()}}},B={key:0,class:"modal-overlay"},G={class:"add-modal"},S={class:"add-modal__content"},$={for:""},Q={key:0,for:""},P={class:"container__table"},I={border:"1"},L=["onClick"],U={for:""},O={for:""},X=["value"],A={for:""},q=["value"],E={for:""},R={class:"modal-actions"};function F(n,t,u,y,i,s){return u.isOpen?(h(),c("div",B,[o("div",G,[o("div",S,[t[18]||(t[18]=o("h2",null,"ThÃªm giá»¯ chá»©c vá»¥",-1)),o("label",$,[t[8]||(t[8]=g(" TÃ¬m giÃ¡o viÃªn: ")),C(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.tuKhoaTimKiem=e),type:"text",placeholder:"Nháº­p mÃ£ giÃ¡o viÃªn hoáº·c tÃªn giÃ¡o viÃªn"},null,512),[[k,i.tuKhoaTimKiem]]),o("button",{id:"search-button",onClick:t[1]||(t[1]=(...e)=>s.goi_api_tim_giao_vien&&s.goi_api_tim_giao_vien(...e))},"ğŸ”")]),i.hienKetQua?(h(),c("label",Q,[t[10]||(t[10]=g(" Káº¿t quáº£: ")),o("div",P,[o("table",I,[t[9]||(t[9]=o("thead",null,[o("tr",null,[o("th",null,"STT"),o("th",null,"MÃ£ giÃ¡o viÃªn"),o("th",null,"TÃªn giÃ¡o viÃªn"),o("th",null,"MÃ£ bá»™ mÃ´n"),o("th",null,"TÃªn bá»™ mÃ´n"),o("th",null,"Chá»n")])],-1)),o("tbody",null,[(h(!0),c(p,null,f(i.ketQuaTimKiem,(e,a)=>(h(),c("tr",{key:e.MaGV},[o("td",null,r(a+1),1),o("td",null,r(e.MaGV),1),o("td",null,r(e.HoTenGV),1),o("td",null,r(e.MaBM),1),o("td",null,r(e.TenBM),1),o("td",null,[o("button",{id:"add-button",onClick:H=>s.them_vao_the_input(e.MaGV),title:"Chá»n giÃ¡o viÃªn nÃ y"},"â•",8,L)])]))),128))])])])])):V("",!0),o("label",U,[t[11]||(t[11]=g(" Nháº­p mÃ£ giÃ¡o viÃªn: ")),C(o("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.MaGV=e),type:"text",name:"",id:"",placeholder:"Nháº­p mÃ£ giÃ¡o viÃªn muá»‘n phÃ¢n cÃ´ng"},null,512),[[k,i.MaGV]])]),o("label",O,[t[13]||(t[13]=g(" Chá»n chá»©c vá»¥: ")),C(o("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.MaCV=e),name:"",id:""},[t[12]||(t[12]=o("option",{disabled:"",value:""},"-- Chá»n chá»©c vá»¥ --",-1)),(h(!0),c(p,null,f(i.danhSachChucVu,e=>(h(),c("option",{key:e.MaCV,value:e.MaCV},r(e.TenCV),9,X))),128))],512),[[v,i.MaCV]])]),o("label",A,[t[15]||(t[15]=g(" NÄƒm há»c: ")),C(o("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.namHocDuocChon=e),name:"",id:""},[t[14]||(t[14]=o("option",{disabled:"",value:""},"-- Chá»n nÄƒm há»c --",-1)),(h(!0),c(p,null,f(i.danhSachNamHoc,e=>(h(),c("option",{key:e.NamHoc,value:e.NamHoc},r(e.NamHoc),9,q))),128))],512),[[v,i.namHocDuocChon]])]),o("label",E,[t[17]||(t[17]=g(" Há»c ká»³: ")),C(o("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.hocKyDuocChon=e),name:"",id:""},t[16]||(t[16]=[o("option",{disabled:"",value:""},"-- Chá»n há»c ká»³ --",-1),o("option",{value:"1"},"1",-1),o("option",{value:"2"},"2",-1)]),512),[[v,i.hocKyDuocChon]])]),o("div",R,[o("button",{onClick:t[6]||(t[6]=e=>n.$emit("close"))},"ÄÃ³ng"),o("button",{onClick:t[7]||(t[7]=(...e)=>s.them_giu_chuc_vu&&s.them_giu_chuc_vu(...e))},"ThÃªm")])])])])):V("",!0)}const j=T(x,[["render",F],["__scopeId","data-v-bff8a61e"]]),z={components:{ThemGiuChucVuVue:j},data(){return{NamHoc:"",HocKy:"",danhSachGiuChucVu:[],danhSachNamHoc:[],hienModalThem:!1,hocKyDuocChon:"",namHocDuocChon:"",duocXoa:!1}},async created(){await this.lay_hoc_ky(),await this.lay_nam_hoc(),await this.hien_danh_sach_nam_hoc()},methods:{format_ngay(n){const t=n.getFullYear(),u=n.getMonth()+1,y=n.getDate();return`${t}-${u}-${y}`},async hien_danh_sach_nam_hoc(){try{const n=await d.get(`${_}/nam-hoc/danh-sach-nam-hoc`);n.data.success&&(this.danhSachNamHoc=n.data.data)}catch(n){throw console.error("Lá»—i láº¥y danh sÃ¡ch nÄƒm há»c:",n),n}},async lay_nam_hoc(){const n=new Date;try{const t=await d.get(`${_}/nam-hoc/lay-nam-hoc-hien-tai?NgayHomNay=${this.format_ngay(n)}`);t.data&&(this.NamHoc=t.data.result.NamHoc,this.namHocDuocChon=this.NamHoc)}catch(t){throw console.error("Lá»—i láº¥y API nÄƒm há»c:",t),t}},async lay_hoc_ky(){const n=new Date;try{const t=await d.get(`${_}/hoc-ky/lay-hoc-ky-hien-tai?NgayHomNay=${this.format_ngay(n)}`);t.data&&(this.HocKy=t.data.data,this.hocKyDuocChon=this.HocKy)}catch(t){throw console.error("Lá»—i láº¥y API há»c ká»³:",t),t}},async hien_danh_sach_giu_chuc_vu(n,t){try{const u=await d.get(`${_}/giu-chuc-vu/danh-sach-giu-chuc-vu?HocKy=${n}&NamHoc=${t}`);if(u.data){this.danhSachGiuChucVu=u.data.data;const y=K(this.NamHoc,t);this.duocXoa=y=="nam_hien_tai"&&n==this.HocKy||y=="nam_sau"}}catch(u){throw console.error("Lá»—i láº¥y API giá»¯ chá»©c vá»¥:",u),u}},async goi_api_them_giu_chuc_vu(n){try{(await d.post(`${_}/giu-chuc-vu/them-giu-chuc-vu`,n)).data.success?(m.fire({icon:"success",title:"ThÃªm thÃ nh cÃ´ng!",text:"Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o há»‡ thá»‘ng.",showConfirmButton:!1,timer:1500,timerProgressBar:!0,toast:!0,position:"top-end",background:"#f0fff4",iconColor:"#2ecc71",customClass:{popup:"success-toast",title:"success-title",content:"success-content"}}),this.hien_danh_sach_giu_chuc_vu(this.HocKy,this.NamHoc),this.hienModalThem=!1):m.fire({icon:"error",title:"ThÃªm tháº¥t báº¡i!",text:"KhÃ´ng thá»ƒ thÃªm dá»¯ liá»‡u vÃ o há»‡ thá»‘ng.",showConfirmButton:!1,timer:1500,timerProgressBar:!0,toast:!0,position:"top-end",background:"#fff1f2",iconColor:"#e74c3c",customClass:{popup:"error-toast",title:"error-title",content:"error-content"}})}catch(t){console.error("Lá»—i thÃªm chá»©c vá»¥:",t),m.fire("Lá»—i!","CÃ³ lá»—i xáº£y ra khi thÃªm dá»¯ liá»‡u!")}},async goi_api_xoa_giu_chuc_vu(n,t,u,y){const i={CV000:"ADMIN",CV001:"HIEU_TRUONG",CV002:"HIEU_PHO",CV004:"TO_TRUONG"},s={CV000:0,CV001:0,CV002:0};if(this.danhSachGiuChucVu.forEach(l=>{l.MaCV==="CV000"?s.CV000++:l.MaCV==="CV001"?s.CV001++:l.MaCV==="CV002"&&s.CV002++}),s[t]<=1&&["CV000","CV001","CV002"].includes(t)){m.fire({icon:"error",title:"KhÃ´ng thá»ƒ xÃ³a!",text:`Há»‡ thá»‘ng pháº£i cÃ³ Ã­t nháº¥t 1 ${t==="CV000"?"Quáº£n trá»‹ viÃªn":t==="CV001"?"Hiá»‡u trÆ°á»Ÿng":"Hiá»‡u phÃ³"}.`,showConfirmButton:!1,timer:1500,timerProgressBar:!0,toast:!0,position:"top-end",background:"#fff1f2",iconColor:"#e74c3c"});return}const e=this.danhSachGiuChucVu.filter(l=>l.MaGV===n&&l.MaCV!==t),a=i[t]&&e.every(l=>!Object.keys(i).includes(l.MaCV));if((await m.fire({title:"XÃ¡c nháº­n xÃ³a",text:"Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a dá»¯ liá»‡u nÃ y khÃ´ng?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"XÃ³a",cancelButtonText:"Há»§y"})).isConfirmed)try{const l=[d.delete(`${_}/giu-chuc-vu/xoa-giu-chuc-vu?MaGV=${n}&MaCV=${t}&HocKy=${u}&NamHoc=${y}`)];a&&(console.log("API xÃ³a quyá»n:",{MaGV:n,MaQuyen:i[t]}),l.push(d.delete(`${_}/co-quyen/xoa-co-quyen?MaGV=${n}&MaQuyen=${i[t]}`))),(await Promise.all(l)).every(N=>N.data.success)?(m.fire({icon:"success",title:"XÃ³a thÃ nh cÃ´ng!",text:"Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c xÃ³a khá»i há»‡ thá»‘ng.",showConfirmButton:!1,timer:1500,timerProgressBar:!0,toast:!0,position:"top-end",background:"#f0fff4",iconColor:"#2ecc71",customClass:{popup:"success-toast",title:"success-title",content:"success-content"}}),await this.hien_danh_sach_giu_chuc_vu(this.hocKyDuocChon,this.namHocDuocChon)):m.fire({icon:"error",title:"XÃ³a tháº¥t báº¡i!",text:"KhÃ´ng thá»ƒ xÃ³a dá»¯ liá»‡u khá»i há»‡ thá»‘ng.",showConfirmButton:!1,timer:1500,timerProgressBar:!0,toast:!0,position:"top-end",background:"#fff1f2",iconColor:"#e74c3c",customClass:{popup:"error-toast",title:"error-title",content:"error-content"}})}catch(l){console.error("Lá»—i xÃ³a chá»©c vá»¥:",l),m.fire("Lá»—i!","CÃ³ lá»—i xáº£y ra khi xÃ³a dá»¯ liá»‡u!")}},mo_modal_them_giu_chuc_vu(){this.hienModalThem=!0},dong_modal_them_giu_chuc_vu(){this.hienModalThem=!1}}},Y={class:"container"},J={class:"container__action"},W={class:"container__add"},Z={class:"container__filter"},tt=["value"],ot={class:"container__table"},nt={border:"1"},et={key:0},it=["onClick"];function at(n,t,u,y,i,s){const e=b("them-giu-chuc-vu-vue");return h(),c("div",Y,[t[11]||(t[11]=o("h1",null,"PhÃ¢n cÃ´ng chá»©c vá»¥",-1)),o("div",J,[o("div",W,[t[4]||(t[4]=o("b",null,"PhÃ¢n cÃ´ng má»›i",-1)),o("button",{onClick:t[0]||(t[0]=(...a)=>s.mo_modal_them_giu_chuc_vu&&s.mo_modal_them_giu_chuc_vu(...a))},"â•")]),o("div",Z,[t[7]||(t[7]=o("b",null,"Há»c ká»³",-1)),C(o("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>i.hocKyDuocChon=a),name:"",id:""},t[5]||(t[5]=[o("option",{disabled:"",value:""},"Chá»n há»c ká»³",-1),o("option",{value:"1"},"1",-1),o("option",{value:"2"},"2",-1)]),512),[[v,i.hocKyDuocChon]]),t[8]||(t[8]=o("b",null,"NÄƒm há»c",-1)),C(o("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>i.namHocDuocChon=a),name:"",id:""},[t[6]||(t[6]=o("option",{disabled:"",value:""},"Chá»n nÄƒm há»c",-1)),(h(!0),c(p,null,f(i.danhSachNamHoc,a=>(h(),c("option",{key:a.NamHoc,value:a.NamHoc},r(a.NamHoc),9,tt))),128))],512),[[v,i.namHocDuocChon]]),o("button",{id:"filter-button",onClick:t[3]||(t[3]=a=>s.hien_danh_sach_giu_chuc_vu(this.hocKyDuocChon,this.namHocDuocChon))}," Liá»‡t kÃª ")])]),M(e,{isOpen:i.hienModalThem,hocky:parseInt(this.HocKy),namhoc:this.NamHoc,onClose:s.dong_modal_them_giu_chuc_vu,onSave:s.goi_api_them_giu_chuc_vu},null,8,["isOpen","hocky","namhoc","onClose","onSave"]),o("div",ot,[o("table",nt,[t[10]||(t[10]=o("thead",null,[o("tr",null,[o("th",null,"STT"),o("th",null,"MÃ£ giÃ¡o viÃªn"),o("th",null,"TÃªn giÃ¡o viÃªn"),o("th",null,"MÃ£ chá»©c vá»¥"),o("th",null,"TÃªn chá»©c vá»¥"),o("th",null,"XÃ³a")])],-1)),o("tbody",null,[i.danhSachGiuChucVu.length===0?(h(),c("tr",et,t[9]||(t[9]=[o("td",{colspan:"6"},"KhÃ´ng cÃ³ dá»¯ liá»‡u giá»¯ chá»©c vá»¥ cho há»c ká»³ vÃ  nÄƒm há»c Ä‘Ã£ chá»n.",-1)]))):V("",!0),(h(!0),c(p,null,f(i.danhSachGiuChucVu,(a,H)=>(h(),c("tr",{key:`${a.MaGV}-${a.MaCV}`},[o("td",null,r(H+1),1),o("td",null,r(a.MaGV),1),o("td",null,r(a.HoTenGV),1),o("td",null,r(a.MaCV),1),o("td",null,r(a.TenCV),1),o("td",null,[i.duocXoa?(h(),c("button",{key:0,onClick:l=>s.goi_api_xoa_giu_chuc_vu(a.MaGV,a.MaCV,a.HocKy,a.NamHoc)}," ğŸ—‘ï¸ ",8,it)):V("",!0)])]))),128))])])])])}const ut=T(z,[["render",at],["__scopeId","data-v-1e8ecd01"]]);export{ut as default};
