import{_ as H,c,a as e,w as T,f as V,F as m,g as M,e as S,t as _,S as p,b as u,A as d,o as r,n as g}from"./index-DsFX8v4I.js";const K={data(){return{NamHoc:"",danhSachNamHoc:[],danhSachToBoMon:[],namHocDuocChon:"",danhSachGiaoVien:[],MaBM:"",toBoMonDuocChon:"",TenBM:"",SoTietChuan:"",danhSachMon:[],danhSachLop:[],phanCong:[],danhSachGiaoVienKiemNhiem:[],danhSachGiaoVienGiuChucVu:[],danhSachChuongTrinh:[],SoTuanHK1:"",SoTuanHK2:""}},async created(){try{await this.lay_thong_tin_session(),await this.lay_nam_hoc(),await this.hien_danh_sach_to_bo_mon(),await Promise.all([this.hien_danh_sach_nam_hoc(),this.hien_danh_sach_giao_vien_theo_bo_mon(),this.hien_danh_sach_chuong_trinh(),this.lay_so_tuan_hoc_ky("1").then(t=>{this.SoTuanHK1=t}),this.lay_so_tuan_hoc_ky("2").then(t=>{this.SoTuanHK2=t})])}catch(t){console.error("Lỗi trong created:",t)}},methods:{async lay_thong_tin_session(){try{const t=await u.get(`${d}/dang-nhap/lay-thong-tin-session`,{withCredentials:!0});t.data.success&&(this.MaBM=t.data.thongTinSession.MaBM,this.TenBM=t.data.thongTinSession.TenBM)}catch(t){throw console.error(t),t}},async hien_thong_tin(t,n){await Promise.all([this.hien_danh_sach_lop(),this.hien_danh_sach_giao_vien_theo_bo_mon(),this.hien_danh_sach_mon_theo_to_bo_mon(),this.hien_danh_sach_phan_cong(t,"1",n),this.hien_danh_sach_phan_cong(t,"2",n),this.hien_danh_sach_giao_vien_giu_chuc_vu(t,"1",n),this.hien_danh_sach_giao_vien_giu_chuc_vu(t,"2",n),this.hien_danh_sach_giao_vien_kiem_nhiem(t,"1",n),this.hien_danh_sach_giao_vien_kiem_nhiem(t,"2",n),this.lay_so_tiet_chuan(t)])},format_ngay(t){const n=t.getFullYear(),h=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${n}-${h}-${i}`},async hien_danh_sach_nam_hoc(){try{const t=await u.get(`${d}/nam-hoc/danh-sach-nam-hoc`);t.data.success&&(this.danhSachNamHoc=t.data.data)}catch(t){throw console.error(t),t}},async hien_danh_sach_to_bo_mon(){try{const t=await u.get(`${d}/bo-mon/danh-sach-bo-mon`);t.data.success&&(this.danhSachToBoMon=t.data.data),this.toBoMonDuocChon=this.MaBM}catch(t){throw console.error(t),t}},async lay_nam_hoc(){const t=new Date;try{const n=await u.get(`${d}/nam-hoc/lay-nam-hoc-hien-tai?NgayHomNay=${this.format_ngay(t)}`);n.data&&(this.NamHoc=n.data.result.NamHoc,this.namHocDuocChon=this.NamHoc)}catch(n){throw console.error("Lỗi lấy API năm học",n),n}},async lay_so_tiet_chuan(t){try{const n=await u.get(`${d}/nam-hoc/lay-so-tiet-chuan?NamHoc=${t}`);n.data.success&&(this.SoTietChuan=n.data.data[0].SoTietChuan)}catch(n){throw console.error(n),n}},async lay_so_tuan_hoc_ky(t){try{const n=await u.get(`${d}/hoc-ky/lay-so-tuan?HocKy=${t}`);if(n.data.success)return n.data.data[0].SoTuan}catch(n){throw console.error(n),n}},async hien_danh_sach_mon_theo_to_bo_mon(){if(!this.toBoMonDuocChon){console.error("Mã bộ môn không hợp lệ"),this.danhSachMon=[];return}try{const t=await u.get(`${d}/mon-hoc/danh-sach-mon-hoc-theo-bo-mon?MaBM=${this.toBoMonDuocChon}`);t.data.success&&(this.danhSachMon=t.data.data)}catch(t){throw console.error(t),t}},async hien_danh_sach_giao_vien_theo_bo_mon(){try{const t=await u.get(`${d}/giao-vien/danh-sach-giao-vien-bm?MaBM=${this.toBoMonDuocChon}`);t.data.success&&(this.danhSachGiaoVien=t.data.data)}catch(t){throw console.error(t),t}},async hien_danh_sach_lop(){try{const t=await u.get(`${d}/lop/danh-sach-lop?NamHoc=${this.namHocDuocChon}`);t.data.success&&(this.danhSachLop=t.data.data)}catch(t){throw console.error(t),t}},async hien_danh_sach_phan_cong(t,n,h){try{const i=await u.get(`
                    ${d}/giang-day/danh-sach-giang-day?NamHoc=${t}&HocKy=${n}&MaBM=${h}
                `);if(i.data.success){const s=i.data.danhSach.map(a=>({maGV:a.MaGV,lop:{TenLop:a.TenLop},mon:{MaMon:a.MaMon,TenMon:a.TenMon},soTietTuan:a.SoTietTuan,hocKy:n}));this.phanCong=[...this.phanCong.filter(a=>a.hocKy!=n),...s]}}catch(i){throw console.error(i),i}},async hien_danh_sach_giao_vien_giu_chuc_vu(t,n,h){try{const i=await u.get(`
                    ${d}/giang-day/lay-so-tiet-mien-giu-chuc-vu?NamHoc=${t}&HocKy=${n}&MaBM=${h}
                `);if(i.data.success){const s=i.data.data.map(a=>({...a,HocKy:n,TenCV:a.TenCV||"Không giữ chức vụ"}));this.danhSachGiaoVienGiuChucVu=[...this.danhSachGiaoVienGiuChucVu.filter(a=>a.HocKy!=n),...s]}}catch(i){throw console.error(i),i}},async hien_danh_sach_giao_vien_kiem_nhiem(t,n,h){try{const i=await u.get(`
                    ${d}/giang-day/lay-so-tiet-mien-kiem-nhiem?NamHoc=${t}&HocKy=${n}&MaBM=${h}
                `);if(i.data.success){const s=i.data.data.map(a=>({...a,HocKy:n,TenNV:a.TenNV||"Không kiêm nhiệm"}));this.danhSachGiaoVienKiemNhiem=[...this.danhSachGiaoVienKiemNhiem.filter(a=>a.HocKy!==n),...s]}}catch(i){throw console.error(i),i}},async hien_danh_sach_chuong_trinh(){try{const t=await u.get(`${d}/chuong-trinh/danh-sach-chuong-trinh`);t.data.success&&(this.danhSachChuongTrinh=t.data.data.map(n=>({MaMon:n.MaMon,SoTietTuan:n.SoTietTuan,Khoi:n.Khoi,TenMon:n.TenMon,MaNhom:n.MaNhom,TenNhom:n.TenNhom,HocKy:n.HocKy,MaBM:n.MaBM})))}catch(t){throw console.error("Lỗi lấy danh sách chương trình:",t),t}},showPopup(t,n,h){if(h=="ChucVu"){const i=this.danhSachGiaoVienGiuChucVu.filter(o=>o.MaGV==t&&o.HocKy==n),s=i.length>0?i.map(o=>`<li>${o.TenCV} (${o.SoTietMien||0} tiết)</li>`).join(""):"<li>Không có chức vụ</li>",a=i.reduce((o,l)=>o+(l.SoTietMien||0),0);p.fire({title:`Thông tin chức vụ học kỳ ${n}`,html:`
                        <ul class="custom-list">
                            <li><strong>Mã giáo viên:</strong> ${t}</li>
                            <li><strong>Danh sách chức vụ:</strong>
                                <ul>${s}</ul>
                            </li>
                            <li><strong>Số tiết chức vụ:</strong> ${a}</li>
                        </ul>
                    `,icon:"info",confirmButtonText:"Đóng",customClass:{popup:"custom-popup"}})}else if(h=="KiemNhiem"){const i=this.danhSachGiaoVienKiemNhiem.filter(o=>o.MaGV==t&&o.HocKy==n),s=i.length>0?i.map(o=>`<li>${o.TenNV} (${o.SoTietMien||0} tiết)</li>`).join(""):"<li>Không có kiêm nhiệm</li>",a=i.reduce((o,l)=>o+(l.SoTietMien||0),0);p.fire({title:`Thông tin kiêm nhiệm học kỳ ${n}`,html:`
                        <ul class="custom-list">
                            <li><strong>Mã giáo viên:</strong> ${t}</li>
                            <li><strong>Danh sách kiêm nhiệm:</strong>
                                <ul>${s}</ul>
                            </li>
                            <li><strong>Tổng số tiết kiêm nhiệm:</strong> ${a}</li>
                        </ul>
                    `,icon:"info",confirmButtonText:"Đóng",customClass:{popup:"custom-popup"}})}else console.log("Có lỗi hiển thị thông tin bảng kết quả")},hien_so_tiet_mien_cv(t,n){return this.danhSachGiaoVienGiuChucVu.filter(i=>i.MaGV==t&&i.HocKy==n).reduce((i,s)=>i+(s.SoTietMien||0),0)},hien_so_tiet_mien_kn(t,n){return this.danhSachGiaoVienKiemNhiem.filter(i=>i.MaGV==t&&i.HocKy==n).reduce((i,s)=>i+(s.SoTietMien||0),0)},hien_so_tiet_phan_cong(t,n){return this.phanCong.filter(h=>h.maGV==t&&h.hocKy==n).reduce((h,i)=>h+(i.soTietTuan||0),0)},hien_tong_so_tiet(t,n){const h=this.hien_so_tiet_phan_cong(t,n),i=this.hien_so_tiet_mien_cv(t,n),s=this.hien_so_tiet_mien_kn(t,n);return h+i+s},hien_tong_so_tiet_vuot_gio(t){const n=this.hien_tong_so_tiet(t,"1"),h=this.hien_tong_so_tiet(t,"2"),i=this.SoTietChuan,s=this.SoTuanHK1,a=this.SoTuanHK2;return(n-i)*s+(h-i)*a},getAssignedTeacher(t,n,h){const i=this.phanCong.find(s=>s.lop.TenLop==t.TenLop&&s.mon.MaMon==n.MaMon&&s.hocKy==h);if(i){const s=this.danhSachGiaoVien.find(a=>a.MaGV==i.maGV);return s?`${s.MaGV} - ${s.HoTenGV}`:i.maGV}return null},tai_thong_ke(){const t=["STT","Mã giáo viên","Họ tên giáo viên","Số tiết chuẩn","Số tiết CV (HK I)","Số tiết KN (HK I)","Số tiết dạy (HK I)","Số tiết CV (HK II)","Số tiết KN (HK II)","Số tiết dạy (HK II)","TS tiết HK I","TS tiết HK II","TS tiết vượt giờ"],n=this.danhSachGiaoVien.map((o,l)=>[l+1,o.MaGV,o.HoTenGV,17,this.hien_so_tiet_mien_cv(o.MaGV,"1"),this.hien_so_tiet_mien_kn(o.MaGV,"1"),this.hien_so_tiet_phan_cong(o.MaGV,"1"),this.hien_so_tiet_mien_cv(o.MaGV,"2"),this.hien_so_tiet_mien_kn(o.MaGV,"2"),this.hien_so_tiet_phan_cong(o.MaGV,"2"),this.hien_tong_so_tiet(o.MaGV,"1"),this.hien_tong_so_tiet(o.MaGV,"2"),this.hien_tong_so_tiet_vuot_gio(o.MaGV)]),h=[t.join(","),...n.map(o=>o.join(","))].join(`
`),i=new Blob([h],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),a=URL.createObjectURL(i);s.setAttribute("href",a),s.setAttribute("download",`PhanCong_${this.namHocDuocChon}.csv`),s.click(),URL.revokeObjectURL(a)}}},C={class:"container"},G={class:"container__action"},k={class:"container__filter"},f=["value"],b=["value"],w={class:"assignment-wrapper"},N={class:"assignment-table"},I={class:"semester-table"},v={key:0,class:"assigned-teacher"},B={key:1,class:"empty-slot"},D={class:"semester-table"},L={key:0,class:"assigned-teacher"},$={key:1,class:"empty-slot"},x={class:"result-table"},A={border:"1"},P={class:"table-display-other"},j={class:"table-display-other"},U={class:"table-display-other"},R={class:"table-display-other"},E=["onClick"],F=["onClick"],q={class:"table-display-term1"},O=["onClick"],z=["onClick"],X={class:"table-display-term2"},Y={class:"table-display-term1"},J={class:"table-display-term2"},Q={class:"download-button"};function W(t,n,h,i,s,a){return r(),c("div",C,[n[17]||(n[17]=e("h1",null,"Xem phân công chuyên môn",-1)),e("div",G,[e("div",k,[n[6]||(n[6]=e("b",null,"Năm học",-1)),T(e("select",{"onUpdate:modelValue":n[0]||(n[0]=o=>s.namHocDuocChon=o),name:"namHoc",id:"namHoc"},[n[4]||(n[4]=e("option",{disabled:"",value:""},"Chọn năm học",-1)),(r(!0),c(m,null,M(s.danhSachNamHoc,o=>(r(),c("option",{key:o.NamHoc,value:o.NamHoc},_(o.NamHoc),9,f))),128))],512),[[V,s.namHocDuocChon]]),n[7]||(n[7]=e("b",null,"Tổ bộ môn",-1)),T(e("select",{"onUpdate:modelValue":n[1]||(n[1]=o=>s.toBoMonDuocChon=o),name:"toBoMonDuocChon",id:"toBoMonDuocChon"},[n[5]||(n[5]=e("option",{disabled:"",value:""},"Chọn tổ bộ môn",-1)),(r(!0),c(m,null,M(s.danhSachToBoMon,o=>(r(),c("option",{key:o.MaBM,value:o.MaBM},_(o.TenBM),9,b))),128))],512),[[V,s.toBoMonDuocChon]]),e("button",{id:"filter-button",onClick:n[2]||(n[2]=o=>a.hien_thong_tin(s.namHocDuocChon,s.toBoMonDuocChon))}," Liệt kê ")])]),e("div",w,[e("div",N,[e("table",I,[n[9]||(n[9]=e("caption",null,"Học kỳ I",-1)),e("thead",null,[e("tr",null,[n[8]||(n[8]=e("th",null,"Lớp / Môn",-1)),(r(!0),c(m,null,M(s.danhSachMon,o=>(r(),c("th",{key:o.MaMon},_(o.TenMon),1))),128))])]),e("tbody",null,[(r(!0),c(m,null,M(s.danhSachLop,o=>(r(),c("tr",{key:o},[e("td",null,_(o.TenLop),1),(r(!0),c(m,null,M(s.danhSachMon,l=>(r(),c("td",{key:`${o.TenLop}-${l.MaMon}-1`,class:"assignment-cell"},[a.getAssignedTeacher(o,l,"1")?(r(),c("div",v,_(a.getAssignedTeacher(o,l,"1")),1)):(r(),c("div",B,"   "))]))),128))]))),128))])]),e("table",D,[n[11]||(n[11]=e("caption",null,"Học kỳ II",-1)),e("thead",null,[e("tr",null,[n[10]||(n[10]=e("th",null,"Lớp / Môn",-1)),(r(!0),c(m,null,M(s.danhSachMon,o=>(r(),c("th",{key:o.MaMon},_(o.TenMon),1))),128))])]),e("tbody",null,[(r(!0),c(m,null,M(s.danhSachLop,o=>(r(),c("tr",{key:o},[e("td",null,_(o.TenLop),1),(r(!0),c(m,null,M(s.danhSachMon,l=>(r(),c("td",{key:`${o.TenLop}-${l.MaMon}-2`,class:"assignment-cell"},[a.getAssignedTeacher(o,l,"2")?(r(),c("div",L,_(a.getAssignedTeacher(o,l,"2")),1)):(r(),c("div",$,"   "))]))),128))]))),128))])])])]),e("div",x,[n[15]||(n[15]=e("h2",null,"Kết quả phân công",-1)),e("div",null,[n[12]||(n[12]=e("strong",null,"Số tuần HK 1: ",-1)),S(_(s.SoTuanHK1),1)]),e("div",null,[n[13]||(n[13]=e("strong",null,"Số tuần HK 2: ",-1)),S(" "+_(s.SoTuanHK2),1)]),n[16]||(n[16]=e("div",{class:"formula-info"},[e("strong",null,"Số tiết vượt giờ"),S(" = (Tổng tiết HK I - Số tiết chuẩn) * Số tuần HK I + (Tổng tiết HK II - Số tiết chuẩn) * Số tuần HK II ")],-1)),e("table",A,[n[14]||(n[14]=e("thead",null,[e("tr",null,[e("th",null,"STT"),e("th",null,"Mã giáo viên"),e("th",null,"Họ tên giáo viên"),e("th",null,"Số tiết chuẩn"),e("th",null,"Số tiết CV HK I"),e("th",null,"Số tiết KN HK I"),e("th",null,"Số tiết dạy HK I"),e("th",null,"Số tiết CV HK II"),e("th",null,"Số tiết KN HK II"),e("th",null,"Số tiết dạy HK II"),e("th",null,"TS tiết HK I"),e("th",null,"TS tiết HK II"),e("th",null,"TS tiết vượt giờ")])],-1)),e("tbody",null,[(r(!0),c(m,null,M(s.danhSachGiaoVien,(o,l)=>(r(),c("tr",{key:o.MaGV},[e("td",P,_(l+1),1),e("td",j,_(o.MaGV),1),e("td",U,_(o.HoTenGV),1),e("td",R,_(s.SoTietChuan||0),1),e("td",{onClick:y=>a.showPopup(o.MaGV,"1","ChucVu"),class:g([{"red-text":a.hien_so_tiet_mien_cv(o.MaGV,"1")>0},"table-display-term1"])},_(a.hien_so_tiet_mien_cv(o.MaGV,"1")),11,E),e("td",{onClick:y=>a.showPopup(o.MaGV,"1","KiemNhiem"),class:g([{"red-text":a.hien_so_tiet_mien_kn(o.MaGV,"1")>0},"table-display-term1"])},_(a.hien_so_tiet_mien_kn(o.MaGV,"1")),11,F),e("td",q,_(a.hien_so_tiet_phan_cong(o.MaGV,"1")),1),e("td",{onClick:y=>a.showPopup(o.MaGV,"2","ChucVu"),class:g([{"red-text":a.hien_so_tiet_mien_cv(o.MaGV,"2")>0},"table-display-term2"])},_(a.hien_so_tiet_mien_cv(o.MaGV,"2")),11,O),e("td",{onClick:y=>a.showPopup(o.MaGV,"2","KiemNhiem"),class:g([{"red-text":a.hien_so_tiet_mien_kn(o.MaGV,"2")>0},"table-display-term2"])},_(a.hien_so_tiet_mien_kn(o.MaGV,"2")),11,z),e("td",X,_(a.hien_so_tiet_phan_cong(o.MaGV,"2")),1),e("td",Y,_(a.hien_tong_so_tiet(o.MaGV,"1")),1),e("td",J,_(a.hien_tong_so_tiet(o.MaGV,"2")),1),e("td",{class:g([{"red-text":a.hien_tong_so_tiet_vuot_gio(o.MaGV)>200},"table-display-other"])},_(a.hien_tong_so_tiet_vuot_gio(o.MaGV)),3)]))),128))])]),e("div",Q,[e("button",{onClick:n[3]||(n[3]=(...o)=>a.tai_thong_ke&&a.tai_thong_ke(...o))}," Tải thống kê ")])])])}const nn=H(K,[["render",W],["__scopeId","data-v-20a68f05"]]);export{nn as default};
