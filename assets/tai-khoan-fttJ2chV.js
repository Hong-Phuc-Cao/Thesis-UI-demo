import{_ as k,S as l,c as d,d as f,a,e as m,w as g,v as M,D as v,o as _,y as V,F as G,g as T,z as S,b as r,A as c,t as p}from"./index-DsFX8v4I.js";const K={props:{isOpen:Boolean,taiKhoan:Object},data(){return{MaGV:"",HoTenGV:"",MatKhauMoi:"",MaQuyen:"",MatKhau:"",danhSachQuyen:[]}},watch:{taiKhoan:{immediate:!0,deep:!0,handler(n){n?(this.MaGV=n.MaGV||"",this.HoTenGV=n.HoTenGV||"",this.MaQuyen=n.MaQuyen||"",this.MatKhau=n.MatKhau||""):(this.MaGV="",this.HoTenGV="",this.MaQuyen="",this.MatKhau="")}}},methods:{lam_moi_form(){this.MatKhauMoi="",this.MaQuyen=""},async luu_thong_tin(){try{if((await l.fire({title:"Xác nhận thay đổi",text:`Bạn có chắc chắn muốn đổi thông tin của giáo viên ${this.HoTenGV} (${this.MaGV})?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Xác nhận",cancelButtonText:"Hủy",reverseButtons:!0})).isConfirmed){let t,s;this.MatKhauMoi.trim()===""?this.$emit("close"):(t={MaGV:this.MaGV,MatKhau:this.MatKhauMoi},this.$emit("save",t)),this.lam_moi_form(),this.$emit("close")}}catch(n){console.error("Lỗi khi lưu thông tin:",n),l.fire("Lỗi",n.message==="Password cannot be empty"?"Mật khẩu mới không được để trống":"Không thể lưu thông tin","error")}}}},C={key:0,class:"modal-overlay"},b={class:"edit-modal"},x={class:"edit-modal__content"},B={class:"modal-actions"};function w(n,t,s,h,o,e){return s.isOpen?(_(),d("div",C,[a("div",b,[a("div",x,[t[9]||(t[9]=a("h2",null,"Sửa mật khẩu",-1)),a("label",null,[t[6]||(t[6]=m(" Tên giáo viên: ")),g(a("input",{disabled:"",type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>o.HoTenGV=i)},null,512),[[M,o.HoTenGV]])]),a("label",null,[t[7]||(t[7]=m(" Mã giáo viên: ")),g(a("input",{disabled:"",type:"text","onUpdate:modelValue":t[1]||(t[1]=i=>o.MaGV=i)},null,512),[[M,o.MaGV]])]),a("label",null,[t[8]||(t[8]=m(" Mật khẩu mới: ")),g(a("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=i=>o.MatKhauMoi=i)},null,512),[[M,o.MatKhauMoi]])]),a("div",B,[a("button",{onClick:t[3]||(t[3]=i=>n.$emit("close"))},"Đóng"),a("button",{onClick:t[4]||(t[4]=(...i)=>e.luu_thong_tin&&e.luu_thong_tin(...i)),onKeyup:t[5]||(t[5]=v((...i)=>e.luu_thong_tin&&e.luu_thong_tin(...i),["enter"]))}," Lưu ",32)])])])])):f("",!0)}const $=k(K,[["render",w],["__scopeId","data-v-43e09ae3"]]),L={components:{SuaTaiKhoanModal:$},data(){return{danhSachTaiKhoan:[],hienModalSua:!1,taiKhoanDangChinhSua:null}},async created(){await this.hien_danh_sach_tai_khoan()},methods:{async hien_danh_sach_tai_khoan(){try{const n=await r.get(`
                    ${c}/nguoi-dung/danh-sach-nguoi-dung
                `);n.data.success&&(this.danhSachTaiKhoan=n.data.data)}catch(n){console.error("Lỗi khi lấy danh sách tk:",n)}},async goi_api_tim_giao_vien(n){try{const t=await r.get(`
                    ${c}/giao-vien/tim-giao-vien?keyword=${n}
                `);if(t.data.success)return t.data.data[0].Mail}catch(t){console.error("Lỗi khi lấy danh sách GV theo bộ môn:",t)}},mo_modal_sua_tai_khoan(n){this.taiKhoanDangChinhSua={...n},this.hienModalSua=!0},dong_modal_sua_tai_khoan(){this.hienModalSua=!1},async goi_api_sua_mat_khau(n){const t=n.MaGV,s={MatKhau:n.MatKhau};try{if((await r.put(`${c}/nguoi-dung/sua-nguoi-dung?MaGV=${t}`,s)).data.success){l.fire({icon:"success",title:"Sửa thành công!",text:"Dữ liệu đã được cập nhật thành công.",showConfirmButton:!1,timer:1500,timerProgressBar:!0,toast:!0,position:"top-end",background:"#f0fff4",iconColor:"#2ecc71",customClass:{popup:"success-toast",title:"success-title",content:"success-content"}}),await this.hien_danh_sach_tai_khoan();const o=await this.goi_api_tim_giao_vien(n.MaGV);this.goi_api_gui_email_mat_khau_moi(n,o),this.dong_modal_sua_tai_khoan()}}catch(h){console.error("Lỗi khi cập nhật tài khoản: ",h),l.fire("Lỗi!","Có lỗi xảy ra khi cập nhật dữ liệu!")}},async goi_api_gui_email_mat_khau_moi(n,t){const s=n.MaGV,h=n.MatKhau;console.log(n.MaGV,t);const o={to:t,subject:"Tài khoản và mật khẩu hệ thống",text:"Chào thầy/cô, đây là thông tin tài khoản của thầy/cô sau khi thay đổi mật khẩu:",html:`
                    <div style="font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6;">
                        <h2 style="color: #0066cc;">Thông tin tài khoản hệ thống</h2>
                        <p>Chào thầy/cô,</p>
                        <p>Đây là thông tin tài khoản sau khi thay đổi mật khẩu:</p>
                        <ul>
                            <li><strong>Mã giáo viên:</strong> ${s}</li>
                            <li><strong>Mật khẩu:</strong> ${h}</li>
                        </ul>
                        <p>Trân trọng,</p>
                        <p><strong>Ban quản trị hệ thống</strong></p>
                    </div>                
                `};try{(await r.post(`${c}/email/gui-email`,o)).data.success&&(this.hien_danh_sach_tai_khoan(),this.hienModalSua=!1)}catch(e){console.log(e),l.fire("Lỗi!","Có lỗi xảy ra khi gửi email cho giáo viên mới")}}}},D={class:"container"},H={class:"container__table"},Q={border:"1"},O=["onClick"];function U(n,t,s,h,o,e){const i=S("sua-tai-khoan-modal");return _(),d("div",D,[t[1]||(t[1]=a("h1",null,"Tài khoản",-1)),a("div",H,[a("table",Q,[t[0]||(t[0]=a("thead",null,[a("tr",null,[a("th",null,"STT"),a("th",null,"Mã giáo viên"),a("th",null,"Tên giáo viên"),a("th",null,"Sửa mật khẩu")])],-1)),a("tbody",null,[(_(!0),d(G,null,T(o.danhSachTaiKhoan,(u,y)=>(_(),d("tr",{key:u},[a("td",null,p(y+1),1),a("td",null,p(u.MaGV),1),a("td",null,p(u.HoTenGV),1),a("td",null,[a("button",{onClick:I=>e.mo_modal_sua_tai_khoan(u)},"✏️",8,O)])]))),128))])]),V(i,{isOpen:o.hienModalSua,taiKhoan:o.taiKhoanDangChinhSua,onClose:e.dong_modal_sua_tai_khoan,onSave:e.goi_api_sua_mat_khau},null,8,["isOpen","taiKhoan","onClose","onSave"])])])}const A=k(L,[["render",U],["__scopeId","data-v-a7b7cfb5"]]);export{A as default};
