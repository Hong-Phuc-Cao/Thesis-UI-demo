import{_ as m,c as l,a as n,w as p,f as C,F as T,g as y,e as H,t as a,d as K,n as d,b as r,A as c,S,o as u}from"./index-DsFX8v4I.js";const N={data(){return{NamHoc:"",HocKy:"",danhSachNamHoc:[],danhSachGiuChucVu:[],danhSachKiemNhiem:[],namHocDuocChon:"",hocKyDuocChon:"",MaGV:"",SoTuanHK1:0,SoTuanHK2:0,phanCongHK1:[],phanCongHK2:[],SoTietChuan:0,SoTietCVHK1:0,SoTietCVHK2:0,SoTietKNHK1:0,SoTietKNHK2:0,SoTietDayHK1:0,SoTietDayHK2:0,TongSoTietHK1:0,TongSoTietHK2:0,TongSoTietVuotGio:0}},async created(){try{await this.lay_thong_tin_session(),await this.lay_nam_hoc(),await this.lay_hoc_ky(),await this.hien_danh_sach_nam_hoc(),this.SoTuanHK1=await this.lay_so_tuan_hoc_ky("1"),this.SoTuanHK2=await this.lay_so_tuan_hoc_ky("2")}catch(o){console.error("Lỗi trong created:",o),S.fire("Lỗi!","Không thể tải dữ liệu ban đầu!","error")}},methods:{async lay_thong_tin_session(){try{const o=await r.get(`${c}/dang-nhap/lay-thong-tin-session`,{withCredentials:!0});o.data.success&&(this.MaGV=o.data.thongTinSession.MaGV)}catch(o){throw console.error("Lỗi lấy thông tin session:",o),o}},format_ngay(o){const t=o.getFullYear(),i=String(o.getMonth()+1).padStart(2,"0"),h=String(o.getDate()).padStart(2,"0");return`${t}-${i}-${h}`},async lay_nam_hoc(){const o=new Date;try{const t=await r.get(`${c}/nam-hoc/lay-nam-hoc-hien-tai?NgayHomNay=${this.format_ngay(o)}`);t.data.success&&(this.NamHoc=t.data.result.NamHoc),this.namHocDuocChon=this.NamHoc}catch(t){throw console.error("Lỗi lấy năm học:",t),t}},async lay_hoc_ky(){const o=new Date;try{const t=await r.get(`${c}/hoc-ky/lay-hoc-ky-hien-tai?NgayHomNay=${this.format_ngay(o)}`);t.data.success&&(this.HocKy=t.data.data),this.hocKyDuocChon=this.HocKy}catch(t){throw console.error("Lỗi lấy học kỳ:",t),t}},async lay_so_tiet_chuan(){try{const o=await r.get(`${c}/nam-hoc/lay-so-tiet-chuan?NamHoc=${this.namHocDuocChon}`);return o.data.success&&(this.SoTietChuan=o.data.data[0].SoTietChuan||0),this.SoTietChuan}catch(o){throw console.error(o),o}},async lay_so_tuan_hoc_ky(o){try{const t=await r.get(`${c}/hoc-ky/lay-so-tuan?HocKy=${o}`);if(t.data.success)return t.data.data[0].SoTuan}catch(t){throw console.error(t),t}},async hien_danh_sach_nam_hoc(){try{const o=await r.get(`${c}/nam-hoc/danh-sach-nam-hoc`);o.data.success&&(this.danhSachNamHoc=o.data.data),this.namHocDuocChon=this.NamHoc}catch(o){throw console.error("Lỗi lấy danh sách năm học:",o),o}},async hien_thong_tin(o){if(o)try{const[t,i,h,e,_,s,g]=await Promise.all([this.hien_danh_sach_phan_cong("1"),this.hien_danh_sach_phan_cong("2"),this.hien_so_tiet_cv("1"),this.hien_so_tiet_cv("2"),this.hien_so_tiet_kn("1"),this.hien_so_tiet_kn("2"),this.lay_so_tiet_chuan()]);this.phanCongHK1=t||[],this.phanCongHK2=i||[],this.SoTietCVHK1=h||0,this.SoTietCVHK2=e||0,this.SoTietKNHK1=_||0,this.SoTietKNHK2=s||0,this.SoTietDayHK1=this.hien_so_tiet_phan_cong("1"),this.SoTietDayHK2=this.hien_so_tiet_phan_cong("2"),this.TongSoTietHK1=await this.hien_tong_so_tiet("1"),this.TongSoTietHK2=await this.hien_tong_so_tiet("2"),this.TongSoTietVuotGio=this.hien_tong_so_tiet_vuot_gio()||0}catch(t){console.error("Lỗi lấy thông tin:",t),S.fire("Lỗi!","Không thể tải dữ liệu phân công!","error")}},async hien_danh_sach_phan_cong(o){try{const t=await r.get(`${c}/giang-day/giang-day-giao-vien?NamHoc=${this.namHocDuocChon}&HocKy=${o}&MaGV=${this.MaGV}`);return t.data.success?t.data.danhSach.map(h=>({lop:{TenLop:h.TenLop},mon:{MaMon:h.MaMon,TenMon:h.TenMon},soTietTuan:h.SoTietTuan})):[]}catch(t){return console.error("Lỗi lấy danh sách phân công:",t),[]}},async hien_so_tiet_cv(o){try{const t=await r.get(`${c}/giang-day/so-tiet-mien-giu-chuc-vu-giao-vien?NamHoc=${this.namHocDuocChon}&HocKy=${o}&MaGV=${this.MaGV}`);if(t.data.success){const i=t.data.data.map(e=>({...e,HocKy:o,TenCV:e.TenCV||"Không giữ chức vụ"}));return this.danhSachGiuChucVu=[...i],i.reduce((e,_)=>e+(_.SoTietMien||0),0)}return this.danhSachGiuChucVu=[],0}catch(t){return console.error("Lỗi lấy số tiết CV:",t),this.danhSachGiuChucVu=[],0}},async hien_so_tiet_kn(o){try{const t=await r.get(`${c}/giang-day/so-tiet-mien-kiem-nhiem-giao-vien?NamHoc=${this.namHocDuocChon}&HocKy=${o}&MaGV=${this.MaGV}`);if(t.data.success){const i=t.data.data.map(e=>({...e,HocKy:o,TenNV:e.TenNV||"Không có kiêm nhiệm"}));return this.danhSachKiemNhiem=[...i],i.reduce((e,_)=>e+(_.SoTietMien||0),0)}return this.danhSachKiemNhiem=[],0}catch(t){return console.error("Lỗi lấy số tiết miễn KN:",t),this.danhSachKiemNhiem=[],0}},hien_so_tiet_phan_cong(o){return o==="1"?this.phanCongHK1.reduce((t,i)=>t+(i.soTietTuan||0),0):this.phanCongHK2.reduce((t,i)=>t+(i.soTietTuan||0),0)},async hien_tong_so_tiet(o){const t=this.hien_so_tiet_phan_cong(o),i=await this.hien_so_tiet_cv(o),h=await this.hien_so_tiet_kn(o);return t+i+h},hien_tong_so_tiet_vuot_gio(){const o=this.TongSoTietHK1,t=this.TongSoTietHK2,i=this.SoTietChuan,h=this.SoTuanHK1,e=this.SoTuanHK2;return console.log(o,t),Math.max(0,(o-i)*h+(t-i)*e)}}},V={class:"container"},M={class:"container__filter"},w=["value"],v={class:"result-table"},b={class:"semester-table"},f={key:0},k={class:"semester-table"},I={key:0},D={class:"summary-table"},L={class:"table-display-other"},G={class:"table-display-term1"},x={class:"table-display-term2"},P={class:"table-display-term1"},$={class:"table-display-term2"};function B(o,t,i,h,e,_){return u(),l("div",V,[t[14]||(t[14]=n("h1",null,"Xem Phân Công Giảng Dạy",-1)),n("div",M,[t[3]||(t[3]=n("b",null,"Năm học",-1)),p(n("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>e.namHocDuocChon=s)},[t[2]||(t[2]=n("option",{disabled:"",value:""},"Chọn năm học",-1)),(u(!0),l(T,null,y(e.danhSachNamHoc,s=>(u(),l("option",{key:s.NamHoc,value:s.NamHoc},a(s.NamHoc),9,w))),128))],512),[[C,e.namHocDuocChon]]),n("button",{id:"filter-button",onClick:t[1]||(t[1]=s=>_.hien_thong_tin(e.namHocDuocChon))}," Liệt kê ")]),n("div",v,[n("div",null,[t[4]||(t[4]=n("strong",null,"Số tuần HK 1: ",-1)),H(a(e.SoTuanHK1),1)]),n("div",null,[t[5]||(t[5]=n("strong",null,"Số tuần HK 2: ",-1)),H(" "+a(e.SoTuanHK2),1)]),t[12]||(t[12]=n("div",{class:"formula-info"},[n("strong",null,"Số tiết vượt giờ"),H(" = (Tổng tiết HK I - Số tiết chuẩn) * Số tuần HK I + (Tổng tiết HK II - Số tiết chuẩn) * Số tuần HK II ")],-1)),n("div",b,[n("table",null,[t[7]||(t[7]=n("caption",null,"Học kỳ I",-1)),t[8]||(t[8]=n("thead",null,[n("tr",null,[n("th",null,"STT"),n("th",null,"Lớp"),n("th",null,"Môn"),n("th",null,"Số tiết/tuần")])],-1)),n("tbody",null,[(u(!0),l(T,null,y(e.phanCongHK1,(s,g)=>(u(),l("tr",{key:`${s.lop.TenLop}-${s.mon.MaMon}`},[n("td",null,a(g+1),1),n("td",null,a(s.lop.TenLop),1),n("td",null,a(s.mon.TenMon),1),n("td",null,a(s.soTietTuan),1)]))),128)),e.phanCongHK1.length==0?(u(),l("tr",f,t[6]||(t[6]=[n("td",{colspan:"4"},"Không có phân công nào",-1)]))):K("",!0)])])]),n("div",k,[n("table",null,[t[10]||(t[10]=n("caption",null,"Học kỳ II",-1)),t[11]||(t[11]=n("thead",null,[n("tr",null,[n("th",null,"STT"),n("th",null,"Lớp"),n("th",null,"Môn"),n("th",null,"Số tiết/tuần")])],-1)),n("tbody",null,[(u(!0),l(T,null,y(e.phanCongHK2,(s,g)=>(u(),l("tr",{key:`${s.lop.TenLop}-${s.mon.MaMon}`},[n("td",null,a(g+1),1),n("td",null,a(s.lop.TenLop),1),n("td",null,a(s.mon.TenMon),1),n("td",null,a(s.soTietTuan),1)]))),128)),e.phanCongHK2.length==0?(u(),l("tr",I,t[9]||(t[9]=[n("td",{colspan:"4"},"Không có phân công nào",-1)]))):K("",!0)])])])]),n("div",D,[n("table",null,[t[13]||(t[13]=n("thead",null,[n("tr",null,[n("th",null,"Số tiết chuẩn"),n("th",null,"Số tiết CV HK I"),n("th",null,"Số tiết KN HK I"),n("th",null,"Số tiết dạy HK I"),n("th",null,"Số tiết CV HK II"),n("th",null,"Số tiết KN HK II"),n("th",null,"Số tiết dạy HK II"),n("th",null,"TS tiết HK I"),n("th",null,"TS tiết HK II"),n("th",null,"TS tiết vượt giờ")])],-1)),n("tbody",null,[n("tr",null,[n("td",L,a(e.SoTietChuan),1),n("td",{class:d(["table-display-term1",{"red-text":e.SoTietCVHK1>0}])},a(e.SoTietCVHK1),3),n("td",{class:d(["table-display-term1",{"red-text":e.SoTietKNHK1>0}])},a(e.SoTietKNHK1),3),n("td",G,a(e.SoTietDayHK1),1),n("td",{class:d(["table-display-term2",{"red-text":e.SoTietCVHK2>0}])},a(e.SoTietCVHK2),3),n("td",{class:d(["table-display-term2",{"red-text":e.SoTietKNHK2>0}])},a(e.SoTietKNHK2),3),n("td",x,a(e.SoTietDayHK2),1),n("td",P,a(e.TongSoTietHK1),1),n("td",$,a(e.TongSoTietHK2),1),n("td",{class:d(["table-display-other",{"red-text":e.TongSoTietVuotGio>200}])},a(e.TongSoTietVuotGio),3)])])])])])}const F=m(N,[["render",B],["__scopeId","data-v-b6dcb2d4"]]);export{F as default};
