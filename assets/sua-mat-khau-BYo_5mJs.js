import{b as h,A as r,r as _,_ as k,c as m,a as i,d as f,e as u,w as c,v as g,S as e,o as d}from"./index-DsFX8v4I.js";const y={async dangXuat(){try{const a=await h.post(`${r}/dang-nhap/xoa-thong-tin-session`,{},{withCredentials:!0});a.data.success?_.push("/login"):console.log("Lỗi đăng xuất: ",a.data.message)}catch(a){throw console.error("Lỗi khi đăng xuất:",a),a}}},M={data(){return{MaGV:"",MaQuyen:"",matKhau:"",matKhauHienTai:"",matKhauMoi1:"",matKhauMoi2:"",hienCanhBao:!1}},async created(){await this.goi_api_lay_thong_tin_session()},watch:{matKhauMoi1:{handler(a){this.hienCanhBao=a!==this.matKhauMoi2}},matKhauMoi2:{handler(a){this.hienCanhBao=a!==this.matKhauMoi1}}},methods:{async goi_api_lay_thong_tin_session(){try{const a=await h.get(`${r}/dang-nhap/lay-thong-tin-session`,{withCredentials:!0});a.data.success&&(this.MaGV=a.data.thongTinSession.MaGV,this.MaQuyen=a.data.thongTinSession.MaQuyen)}catch(a){throw console.error("Lỗi gọi api lấy thông tin session",a),a}},async kiem_tra_mat_khau(){const a={MaGV:this.MaGV,MatKhau:this.matKhauHienTai};try{return(await h.post(`${r}/dang-nhap/kiem-tra-dang-nhap`,a,{withCredentials:!0})).data.success?1:0}catch(t){if(t.response)switch(t.response.status){case 401:console.error(t),e.fire("Lỗi!","Sai mật khẩu");break;case 404:console.error(t),e.fire("Lỗi!","Tài khoản không tồn tại");break;case 500:console.error(t),e.fire("Lỗi!","Có lỗi từ phía server");break;default:console.error(t),e.fire("Lỗi!","Có lỗi xảy ra")}else e.fire("Lỗi!","Không thể kết nối đến server"),console.log(t)}},async goi_api_tim_giao_vien(a){try{const t=await h.get(`
                    ${r}/giao-vien/tim-giao-vien?keyword=${a}
                `);if(t.data.success)return t.data.data[0].Mail}catch(t){console.error("Lỗi khi lấy danh sách GV theo bộ môn:",t)}},async goi_api_gui_email(a){const t={to:a,subject:"Tài khoản và mật khẩu hệ thống",text:"Chào thầy/cô, đây là thông tin tài khoản của thầy/cô để đăng nhập vào hệ thống:",html:`
                    <div style="font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6;">
                        <h2 style="color: #0066cc;">Thông tin tài khoản hệ thống</h2>
                        <p>Chào thầy/cô,</p>
                        <p>Đây là thông tin tài khoản sau khi thay đổi mật khẩu:</p>
                        <ul>
                            <li><strong>Mã giáo viên:</strong> ${this.MaGV}</li>
                            <li><strong>Mật khẩu:</strong> ${this.matKhauMoi1}</li>
                        </ul>
                        <p>Trân trọng,</p>
                        <p><strong>Ban quản trị hệ thống</strong></p>
                    </div>                
                `};try{(await h.post(`${r}/email/gui-email`,t)).data.success&&(this.hienModalThem=!1)}catch(s){console.log(s),e.fire("Lỗi!","Có lỗi xảy ra khi gửi email cho giáo viên mới")}},async luu_mat_khau(){if(this.hienCanhBao==!1){const a=await this.kiem_tra_mat_khau();if(a==1){const t={MatKhau:this.matKhauMoi1};try{if((await h.put(`${r}/nguoi-dung/sua-nguoi-dung?MaGV=${this.MaGV}`,t)).data.success){e.fire({icon:"success",title:"Đã sửa mật khẩu!",text:"Dữ liệu đã được cập nhật thành công.",showConfirmButton:!1,timer:1500,timerProgressBar:!0,toast:!0,position:"top-end",background:"#f0fff4",iconColor:"#2ecc71",customClass:{popup:"success-toast",title:"success-title",content:"success-content"}});const l=await this.goi_api_tim_giao_vien(this.MaGV);console.log(l),this.goi_api_gui_email(l),await y.dangXuat()}}catch(s){console.error("Lỗi khi cập nhật tài khoản: ",s),console.log(this.MaGV),console.log(t),e.fire("Lỗi!","Có lỗi xảy ra khi cập nhật dữ liệu!")}}else console.log("Kết quả kiểm tra mk: ",a)}else console.log("Hiện cảnh báo: ",this.hienCanhBao)}}},w={class:"container"},K={class:"container__change-pw"},v={for:""},C={for:""},V={for:""},x={key:0},T={class:"container__action"};function b(a,t,s,l,n,p){return d(),m("div",w,[t[7]||(t[7]=i("h1",null,"Sửa mật khẩu",-1)),i("div",K,[i("label",v,[t[4]||(t[4]=u(" Mật khẩu hiện tại: ")),c(i("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>n.matKhauHienTai=o),type:"password",placeholder:""},null,512),[[g,n.matKhauHienTai]])]),i("label",C,[t[5]||(t[5]=u(" Mật khẩu mới: ")),c(i("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>n.matKhauMoi1=o),type:"text",placeholder:"Nhập mật khẩu mới"},null,512),[[g,n.matKhauMoi1]])]),i("label",V,[t[6]||(t[6]=u(" Nhập lại mật khẩu mới: ")),c(i("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>n.matKhauMoi2=o),type:"text",placeholder:"Nhập lại mật khẩu mới"},null,512),[[g,n.matKhauMoi2]])]),n.hienCanhBao?(d(),m("p",x,"Mật khẩu xác nhận không trùng khớp")):f("",!0),i("div",T,[i("button",{onClick:t[3]||(t[3]=(...o)=>p.luu_mat_khau&&p.luu_mat_khau(...o))}," Xác nhận ")])])])}const L=k(M,[["render",b],["__scopeId","data-v-7db5c05c"]]);export{L as default};
